<div id="googleMap" style="width:100%;height:900px;"></div>

<script type="text/javascript">
  var data = <%== @data.to_json %>;

  google.maps.event.addDomListener(window, 'load', initialize);

  function initialize() {
    geocoder = new google.maps.Geocoder();
    geocoder.geocode({ 'address': 'Malmo, Sweden' }, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        var mapProp = {
          center: results[0].geometry.location,
          zoom: 8,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

        data.forEach(function(event) {
          var coords = new google.maps.LatLng(event.lat, event.lon);
          var marker = new google.maps.Marker({
            position: coords,
            map: map
          });
        });
      }
    });
  }
</script>
