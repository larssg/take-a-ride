<div class="row">
  <div class="col-md-6">
    <div id="googleMap" style="width:100%;height:400px;"></div>
  </div>

  <div class="col-md-6">
    <% @data.each do |event| %>
      <% if event[:event] == 'PAUSE' || event[:event] == 'STOP' %>
        <%= image_tag street_view_image_url(event[:lat], event[:lon], event[:heading]) %>
      <% end %>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  var data = <%== @data.to_json %>;

  google.maps.event.addDomListener(window, 'load', initialize);

  function initialize() {
    var mapProp = {
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

    var bounds = new google.maps.LatLngBounds();

    data.forEach(function(event) {
      var coords = new google.maps.LatLng(event.lat, event.lon);
      var marker = new google.maps.Marker({
        position: coords,
        map: map
      });

      bounds.extend(marker.position);
    });

    map.fitBounds(bounds);
  }
</script>
